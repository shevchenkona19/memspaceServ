version: '2.0'
services:
  db:
    image: postgres:10.3
    command: -p 7654
    volumes:
      - 'database:/var/lib/postgresql/data'
    environment:
      - POSTGRES_USER=memspace
      - POSTGRES_PASSWORD=memspace
      - POSTGRES_DB=memspace-main
    ports:
      - '7654:7654'

  web:
    image: node:10.1.0
    working_dir: '/app'
    command: 'npm run dc:start'
    ports:
      - "${DOCKER_PORT}:13000"
    links:
      - db:db
    volumes:
      - './src:/app/src'
      - './package.json:/app/package.json'
      - './development.json:/app/development.json'
      - './migrations:/app/migrations'
      - 'node_modules:/app/node_modules'
    environment:
      - SERVER_URL=${SERVER_URL}
      - HOST=localhost
      - DATABASE_URL=postgres://memspace:memspace@db:7654/memspace-main
      - PORT=13000

  npm:
      image: node:10.1.0
      working_dir: '/app'
      entrypoint: 'npm'
      volumes:
        - './package.json:/app/package.json'
        - './package-lock.json:/app/package-lock.json'
        - 'node_modules:/app/node_modules'
        - './src:/app/src'
volumes:
  database:
  node_modules: